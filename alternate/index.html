<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.30/"></script>
    <script type="module" src="https://js.arcgis.com/map-components/4.30/arcgis-map-components.esm.js"></script>
    <style>
        body {
            height: 100vh;
            width: 100%;
        }

        #map {
            height: 90vh;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <label for id="intersection">Nearest Intersection</label>
    <input type="text" id="intersection">
    <script>
        require ([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/FeatureLayer",
            "esri/geometry/geometryEngine",
            "esri/tasks/support/Query"
        ], function(Map, MapView, FeatureLayer, geometryEngine, Query) {

            var map = new Map({
                basemap: "streets"
            });

            var view = new MapView({
                container: "map",
                center: [-122.99184422273991, 45.596667353862095],
                zoom: 15 
            });

            function printProjection(layer) {
            console.log(`${layer.title} projection: ${layer.spatialReference.wkid}`);
            }

            var geojsonLayer = new GeoJSONLayer({
                url: "intersections.json",
                renderer: new SimpleRenderer({
                    symbol: new SimpleMarkerSymbol({
                        size: 1,
                        color: "white"
                    })
                })
            });

            var featureLayer = new FeatureLayer({
                url: "https://services3.arcgis.com/pZZTDhBBLO3B9dnl/arcgis/rest/services/survey123_64d4f78251234606b2b8bfd0e29ffde6/FeatureServer/0"
            });

            map.add(featureLayer);

            view.on("click", function(event) {
                var query = featurelayer.createQuere();
                query.geometry = event.mapPoint;
                query.distance = 500;
                query.units = "meters";
                qyery.spatialRelationship = "intersects";
                query.returnGeometry = true;
                query.outFields = ["*"];

                featureLayer.queryFeatures(query).then(function(response) {
                    if (response.features.length > 0) {
                        var closestFeature = response.features[0];
                        var minDistance = geometryEngine.distance(event.mapPoint, closestFeature.geometry, "meters")

                        response.features.forEach(function(feature) {
                            var distance = geometryEngine.distance(event.mapPoint, feature.geometry, "meters");
                            if (distance < minDistance) {
                                closestFeature = feature;
                                minDistance = distance;
                            }
                        });

                        var name = closestFeature.attributes("fileName");
                        document.getElementById("intersection").value = name;
                    }
                });
            });
        });
    </script>
</body>
</html>